---
title: 树上差分
date: 2017-11-7
categories:
- note
- 树
tags:
- 差分
- 树
---

据说近几年NOIp考得比较多, 于是去研究了一下, 做点笔记
<!-- more -->
## 树上前缀和:

说到差分就不得不说到前缀和(因为两个互为逆操作). 对于树上差分, 我们需要定义一个类似前缀和的操作来将差分转化为原来的值. 定义树上某个结点的前缀和为**它本身及其所有后代结点的权值之和**

(为什么这样定义? 也许是好算吧...)

## 树上差分:

说完树上前缀和, 进入正题

差分一般是用来做区间修改的, 而树上差分也是一个道理

这里树上的"区间"指的其实是一条树链

我们可以对每个树上的结点定义一个数d, 表示某个结点与它所有子结点的权值之和的差, 叶子结点的d即为它本身

定义了d之后, 我们就可以和序列一样, 把树上"区间"的操作转化为单点的操作.

![tree](/assets/images/tree.png)

比如上图, 我们如果要把4到8的路径上的所有结点的权值加上1, 那么对于d来说则是d(8)+1,d(1)-1

同理, 如果要把1到7的路径上的所有结点权值加3, 对应d的操作则是d(7)+1,d(0)-1 (假设1的父节点是0)

我们可以记录下d改变值, 当需要询问某个点改变后的权值时, 
